{% extends "base.html" %}
{% load static %}

{% block content %}
<form method="post">
  {% csrf_token %}
  {{ form.as_p }}

  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const departmentField = document.getElementById('id_department');
        const semesterTypeField = document.getElementById('id_semester_type');
        const semesterField = document.getElementById('id_semester');
        const batchField = document.getElementById('id_batch');
        const subjectField = document.getElementById('id_subject');
  
        // Function to update semesters
        function updateSemesters() {
            const departmentId = departmentField.value;
            const semesterTypeId = semesterTypeField.value;
  
            if (departmentId && semesterTypeId) {
                const url = `{% url 'ajax_load_semesters' %}?department=${departmentId}&semester_type=${semesterTypeId}`;
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        semesterField.innerHTML = '<option value="">Select Semester</option>';
                        data.semesters.forEach(function(semester) {
                            const option = new Option(semester.name, semester.id);
                            semesterField.appendChild(option);
  
                            // Clear batch and subject fields when semester changes
                            batchField.innerHTML = '<option value="">Select Batch</option>';
                            subjectField.innerHTML = '<option value="">Select Subject</option>';
                        });
                    });
            }
        }
  
        // Function to update batches
        function updateBatches() {
            const semesterId = semesterField.value;
  
            if (semesterId) {
                const url = `{% url 'ajax_load_batches' %}?semester=${semesterId}`;
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        batchField.innerHTML = '<option value="">Select Batch</option>';
                        data.batches.forEach(function(batch) {
                            const option = new Option(batch.name, batch.id);
                            batchField.appendChild(option);
                        });
  
                        // Clear subject field when batch changes
                        subjectField.innerHTML = '<option value="">Select Subject</option>';
                    });
            }
        }
  
        // Function to update subjects
        function updateSubjects() {
            const semesterId = semesterField.value;
  
            if (semesterId) {
                const url = `{% url 'ajax_load_subjects' %}?semester=${semesterId}`;
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        subjectField.innerHTML = '<option value="">Select Subject</option>';
                        data.subjects.forEach(function(subject) {
                            const option = new Option(subject.sub_name, subject.id);
                            subjectField.appendChild(option);
                        });
                    });
            }
        }
  
        // Event listeners
        departmentField.addEventListener('change', updateSemesters);
        semesterTypeField.addEventListener('change', updateSemesters);
        semesterField.addEventListener('change', updateBatches);
        semesterField.addEventListener('change', updateSubjects);
    });
  </script>
  
  <button type="submit">Submit</button>
</form>
{% endblock %}
