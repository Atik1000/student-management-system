{% extends "base.html" %}
{% load static %}

{% block content %}
<form method="post" id="subject-choice-form">
    {% csrf_token %}
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form.department.label_tag }} {{ form.department }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.semester_type.label_tag }} {{ form.semester_type }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.semester.label_tag }} {{ form.semester }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.batch.label_tag }} {{ form.batch }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.subject.label_tag }} {{ form.subject }}
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
</form>

<script type="text/javascript">
 document.addEventListener('DOMContentLoaded', function() {
    const departmentField = document.getElementById('id_department');
    const semesterTypeField = document.getElementById('id_semester_type');
    const semesterField = document.getElementById('id_semester');
    const batchField = document.getElementById('id_batch');
    const subjectField = document.getElementById('id_subject');

    function updateSemesters() {
        const departmentId = departmentField.value;
        const semesterTypeId = semesterTypeField.value;

        if (departmentId && semesterTypeId) {
            const url = `{% url 'ajax_load_semesters' %}?department=${departmentId}&semester_type=${semesterTypeId}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    semesterField.innerHTML = '<option value="">Select Semester</option>';
                    data.semesters.forEach(function(semester) {
                        const option = new Option(semester.name, semester.id);
                        semesterField.appendChild(option);
                    });

                    batchField.innerHTML = '<option value="">Select Batch</option>';
                    subjectField.innerHTML = '<option value="">Select Subject</option>';
                })
                .catch(error => console.error('Error loading semesters:', error));
        }
    }

    function updateBatches() {
        const semesterId = semesterField.value;

        if (semesterId) {
            const url = `{% url 'ajax_load_batches' %}?semester=${semesterId}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    batchField.innerHTML = '<option value="">Select Batch</option>';
                    data.batches.forEach(function(batch) {
                        const option = new Option(batch.name, batch.id);
                        batchField.appendChild(option);
                    });

                    subjectField.innerHTML = '<option value="">Select Subject</option>';
                })
                .catch(error => console.error('Error loading batches:', error));
        }
    }

    function updateSubjects() {
        const semesterId = semesterField.value;
        const batchId = batchField.value;

        if (semesterId && batchId) {
            const url = `{% url 'ajax_load_subjects' %}?semester=${semesterId}&batch=${batchId}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    subjectField.innerHTML = '<option value="">Select Subject</option>';
                    data.subjects.forEach(function(subject) {
                        const option = new Option(subject.sub_name, subject.id);
                        option.setAttribute('data-credit', subject.credit);
                        subjectField.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading subjects:', error));
        }
    }

    departmentField.addEventListener('change', updateSemesters);
    semesterTypeField.addEventListener('change', updateSemesters);
    semesterField.addEventListener('change', updateBatches);
    batchField.addEventListener('change', updateSubjects);
});


</script>
{% endblock %}
